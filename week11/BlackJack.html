<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack Game</title>
    <link rel="stylesheet" href="styles/style.css">
    <script>
        const cardValues = ['ace', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'jack', 'queen', 'king'];
        const cardSuits = ['spades', 'hearts', 'diamonds', 'clubs'];

        let dealerCards = [];
        let playerCards = [];
        let gameOver = false;

        const startGame = () => {
            const username = document.userForm.elements[0].value.trim();

            validateUserName(username)
                .then(validUsername => {
                    document.getElementById('userForm').style.display = 'none';
                    document.getElementById('gameArea').style.display = 'block';
                    document.getElementById('welcomeMessage').textContent = `Welcome ${validUsername}!`;

                    dealCards();
                })
                .catch(error => alert(error));
        }

        const dealCards = () => {
            dealerCards = getRandomCards(2);
            playerCards = getRandomCards(2);

            displayCards('dealerCards', dealerCards);
            displayCards('playerCards', playerCards);
        }

        const getRandomCards = (numCards) => {
            const cards = [];
            for (let i = 0; i < numCards; i++) {
                const randomValue = cardValues[Math.floor(Math.random() * cardValues.length)];
                const randomSuit = cardSuits[Math.floor(Math.random() * cardSuits.length)];
                const card = `<img src="images/${randomValue}_of_${randomSuit}.svg" height="87" width="100">`;
                cards.push(card);
            }
            return cards;
        }

        const displayCards = (elementId, cards) => {
            document.getElementById(elementId).innerHTML = cards.join('');
        }

        const hit = () => {
            if (!gameOver) {
                const newCard = getRandomCards(1)[0];
                playerCards.push(newCard);
                displayCards('playerCards', playerCards);


                const playerScore = calculateScore(playerCards);
                if (playerScore > 21) {
                    gameOver = true;
                    const result = 'Bust! Dealer wins.';
                    displayResult(result);
                }
            }
        }

        const stand = () => {
            if (!gameOver) {
                let playerScore = calculateScore(playerCards);
                let dealerScore = calculateScore(dealerCards);

                while (dealerScore < 17) {
                    const newCard = getRandomCards(1)[0];
                    dealerCards.push(newCard);
                    dealerScore = calculateScore(dealerCards);
                    displayCards('dealerCards', dealerCards);
                }

                const result = determineWinner(playerScore, dealerScore);
                gameOver = true;
                displayResult(result);
            }
        }

        const calculateScore = (cards) => {
            let score = 0;
            let hasAce = false;

            for (const card of cards) {
                const value = getCardValue(card);
                if (value === 'ace') {
                    hasAce = true;
                    score += 11;
                } else if (value === 'jack' || value === 'queen' || value === 'king') {
                    score += 10;
                } else {
                    score += value;
                }
            }

            if (score > 21 && hasAce) {
                score -= 10;
            }

            return score;
        }

        const getCardValue = (card) => {
            const value = card.split('_')[0];
            return value === 'ace' ? 'ace' : value;
        }

        const determineWinner = (playerScore, dealerScore) => {
            if (playerScore > 21) {
                return 'Bust! Dealer wins.';
            } else if (dealerScore > 21) {
                return 'Dealer busts! You win!';
            } else if (playerScore > dealerScore) {
                return 'You win!';
            } else if (playerScore < dealerScore) {
                return 'Dealer wins.';
            } else {
                return 'It\'s a tie!';
            }
        }

        const displayResult = (result) => {
            document.getElementById('resultMessage').textContent = result;
            disableButtons();
        }

        const disableButtons = () => {
            document.getElementById('hitButton').disabled = true;
            document.getElementById('standButton').disabled = true;
        }

        const validateUserName = (userName) => {
            return new Promise((resolve, reject) => {
                if (!userName.trim()) {
                    reject("User name cannot be blank.");
                } else if (!/^[a-zA-Z]+$/.test(userName)) {
                    reject("User name can only contain alphabetic characters.");
                } else {
                    resolve(userName);
                }
            });
        }

        const returnToForm = () => {
            alert("return to form");
            document.getElementById('userForm').style.display = 'block';
            document.getElementById('gameArea').style.display = 'none';
        }
    </script>
</head>
<body>
    <div class="game-container">
        <h1>Blackjack Game</h1>
        <form name="userForm" id="userForm" style="display: block;">
            Enter your name: <input type="text">
            <input type="button" value="Start Game" onclick="startGame()">
        </form>
    </div>

    <div id="gameArea" style="display: none;">
        <h2 id="welcomeMessage"></h2>

        <div>
            <h3>Dealer's Cards:</h3>
            <div id="dealerCards" class="cards"></div>
        </div>

        <div>
            <h3>Your Cards:</h3>
            <div id="playerCards" class="cards"></div>
        </div>

        <div id="buttons">
            <button id="hitButton" onclick="hit()">Hit</button>
            <button id="standButton" onclick="stand()">Stand</button>
        </div>

        <h3 id="resultMessage"></h3>

        <button onclick="returnToForm()">Return to Form</button>
    </div>

</body>
</html>
